<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>자판기 프로그램</title>
    <link rel="stylesheet" href="/index.css">

</head>
<body>
<div class="container">
    <div class="title">★ 자판기 프로그램 ★</div>

    <button class="end-btn">−</button>

    <div class="header">
        <button class="dropdown">▽ 자판기 상품 목록</button>
        <div class="toggle-wrapper">
            <div class="toggle-container">
                <label>한글</label>
                <div class="toggle" id="toggle"></div>
                <label>ENG</label>
            </div>
        </div>
    </div>

    <div class="content">
        <div class="product-list">상품 목록이 비어있습니다.</div>
        <div class="status">▲ 총 0개의 상품이 있습니다.</div>
        <a th:href="@{/add}" class="add-btn" id="addProductBtn">상품 추가하기!</a>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        fetch("/api/products")
            .then(res => res.json())
            .then(data => {
                const listEl = document.querySelector(".product-list");
                const statusEl = document.querySelector(".status");

                if (data.length === 0) {
                    listEl.textContent = "상품 목록이 비어있습니다.";
                    statusEl.textContent = "▲ 총 0개의 상품이 있습니다.";
                } else {
                    // 테이블 생성
                    const table = document.createElement("table");
                    table.style.width = "100%";
                    table.style.borderCollapse = "collapse";

                    // 헤더 생성
                    const thead = document.createElement("thead");
                    thead.innerHTML = `
                        <tr>
                            <th style="border-bottom:1px solid #999; padding:5px;">이름</th>
                            <th style="border-bottom:1px solid #999; padding:5px;">가격</th>
                            <th style="border-bottom:1px solid #999; padding:5px;">유통기한</th>
                            <th style="border-bottom:1px solid #999; padding:5px;">수정</th>
                            <th style="border-bottom:1px solid #999; padding:5px;">삭제</th>
                        </tr>
                    `;
                    table.appendChild(thead);

                    // 본문 생성
                    const tbody = document.createElement("tbody");
                    data.forEach(product => {
                        const row = document.createElement("tr");

                        row.innerHTML = `
                            <td style="padding:5px;">${product.name}</td>
                            <td style="padding:5px;">${product.price}원</td>
                            <td style="padding:5px;">${product.limit_date}</td>
                            <td style="padding:5px;"><button onclick="editProduct(${product.id})" style="background:blue; color:white; border:none; border-radius:8px; padding:5px 10px; cursor:pointer;">수정</button></td>
                            <td style="padding:5px;"><button onclick="deleteProduct(${product.id})" style="background:red; color:white; border:none; border-radius:8px; padding:5px 10px; cursor:pointer;">삭제</button></td>
                        `;
                        tbody.appendChild(row);
                    });
                    table.appendChild(tbody);

                    // 기존 메시지 제거 후 테이블 삽입
                    listEl.innerHTML = "";
                    listEl.appendChild(table);

                    statusEl.textContent = `▲ 총 ${data.length}개의 상품이 있습니다.`;
                }
            });
    });

    // 수정 버튼 동작 예시
    function editProduct(id) {
        alert("수정 기능 호출됨! 상품 ID: " + id);
        window.location.href = `/edit/${id}`; // 실제 수정 페이지로 이동 시
    }

    // 삭제 버튼 동작 예시
    function deleteProduct(id) {
        if (confirm("정말 삭제하시겠습니까?")) {
            fetch(`/api/products/${id}`, {
                method: "DELETE"
            }).then(() => {
                alert("삭제 완료!");
                location.reload(); // 새로고침으로 목록 갱신
            });
        }
    }

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자판기 프로그램</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #222;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            background-color: #c91d1d;
            color: white;
            width: 400px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            position: relative;
            border: 3px solid black;
        }
        .title {
            font-size: 20px;
            font-weight: bold;
            font-style: italic;
            margin-bottom: 10px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .dropdown {
            background: white;
            color: #c91d1d;
            padding: 6px 12px;
            border-radius: 5px;
            border: none;
            font-weight: bold;
            cursor: pointer;
        }
        .toggle-wrapper {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .toggle-container {
            display: flex;
            align-items: center;
            background: white;
            padding: 4px 8px;
            border-radius: 15px;
        }
        .toggle-container label {
            font-size: 14px;
            color: #c91d1d;
            font-weight: bold;
            margin: 0 5px;
        }
        .toggle {
            width: 36px;
            height: 18px;
            background: #ccc;
            border-radius: 20px;
            cursor: pointer;
            position: relative;
        }
        .toggle::before {
            content: "";
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            top: 1px;
            left: 2px;
            transition: 0.3s;
        }
        .toggle.active::before {
            left: 18px;
            background: #c91d1d;
        }
        .end-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: 2px solid white;
            color: white;
            font-size: 18px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
        }
        .content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .product-list {
            background: white;
            color: #222;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-weight: bold;
            width: 90%;
        }
        .status {
            background: white;
            color: red;
            padding: 8px;
            border-radius: 5px;
            font-size: 14px;
            margin-top: 10px;
            text-align: right;
            font-weight: bold;
            width: 50%;
           /* 위치 정렬 */
            align-self: flex-end;

            /* 필요시 우측 여백 추가 */
            margin-right: 3%;
            }
        .add-btn {
            background: #e33;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            font-size: 14px;
            width: 90%;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="title">★ 자판기 프로그램 ★</div>

    <button class="end-btn">−</button>

    <div class="header">
        <button class="dropdown">▽ 자판기 상품 목록</button>
        <div class="toggle-wrapper">
            <div class="toggle-container">
                <label>한글</label>
                <div class="toggle" id="toggle"></div>
                <label>ENG</label>
            </div>
        </div>
    </div>

    <div class="content">
        <div class="product-list">상품 목록이 비어있습니다.</div>
        <div class="status">▲ 총 0개의 상품이 있습니다.</div>
        <button th:href="@{/api/add}" class="add-btn"  id="addProductBtn">상품 추가하기!</button>
    </div>
</div>

    <script>
        // 상품 목록 불러오기
        async function loadProducts() {
            const res = await fetch('/api/products');
            const products = await res.json();

            const listEl = document.querySelector('.product-list');
            const statusEl = document.querySelector('.status');

            if (products.length === 0) {
                listEl.innerHTML = "상품 목록이 비어있습니다.";
                statusEl.innerHTML = "▲ 총 0개의 상품이 있습니다.";
                return;
            }

            listEl.innerHTML = products.map(p =>
                `<div>🧃 ${p.name} - ${p.price}원 (${p.expireDate})</div>`
            ).join('');
            statusEl.innerHTML = `▲ 총 ${products.length}개의 상품이 있습니다.`;
        }

        // 한글/ENG 토글
        document.getElementById('toggle').addEventListener('click', function () {
            this.classList.toggle('active');
        });

        // 상품 추가 버튼 (임시로 prompt 사용)
        document.getElementById('addProductBtn').addEventListener('click', async function () {
            const name = prompt("상품 이름을 입력하세요:");
            const price = prompt("상품 가격을 입력하세요:");
            const expireDate = prompt("유통기한을 입력하세요 (예: 2025-12-31):");

            if (!name || !price || !expireDate) {
                alert("모든 값을 입력해주세요.");
                return;
            }

            const product = {
                name: name,
                price: parseInt(price),
                expireDate: expireDate
            };

            const res = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(product)
            });

            if (res.ok) {
                alert("상품이 추가되었습니다!");
                loadProducts();
            } else {
                alert("상품 추가 실패!");
            }
        });

        // 페이지 로딩 시 상품 목록 불러오기
        window.onload = loadProducts;
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>자판기 프로그램</title>
    <style>
        body {
          font-family: Arial, sans-serif;
          background-color: #222;
          display: flex;
          justify-content: center;
          align-items: center;
          height: 100vh;
          margin: 0;
        }

        .container {
          background-color: #c91d1d;
          color: white;
          width: 400px;
          padding: 15px;
          border-radius: 10px;
          text-align: center;
          position: relative;
          border: 3px solid black;
        }

        .title {
          font-size: 20px;
          font-weight: bold;
          font-style: italic;
          margin-bottom: 10px;
        }

        .header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 10px;
        }

        .dropdown {
          background: white;
          color: #c91d1d;
          padding: 6px 12px;
          border-radius: 5px;
          border: none;
          font-weight: bold;
          cursor: pointer;
        }

        .toggle-wrapper {
          display: flex;
          align-items: center;
          gap: 5px;
        }

        .toggle-container {
          display: flex;
          align-items: center;
          background: white;
          padding: 4px 8px;
          border-radius: 15px;
        }

        .toggle-container label {
          font-size: 14px;
          color: #c91d1d;
          font-weight: bold;
          margin: 0 5px;
        }

        .toggle {
          width: 36px;
          height: 18px;
          background: #ccc;
          border-radius: 20px;
          cursor: pointer;
          position: relative;
        }

        .toggle::before {
          content: "";
          position: absolute;
          width: 16px;
          height: 16px;
          background: white;
          border-radius: 50%;
          top: 1px;
          left: 2px;
          transition: 0.3s;
        }

        .toggle.active::before {
          left: 18px;
          background: #c91d1d;
        }

        .end-btn {
          position: absolute;
          top: 10px;
          right: 10px;
          background: none;
          border: 2px solid white;
          color: white;
          font-size: 18px;
          width: 28px;
          height: 28px;
          border-radius: 50%;
          cursor: pointer;
        }

        .content {
          display: flex;
          flex-direction: column;
          align-items: center;
        }

        .product-list {
          background: white;
          color: #222;
          padding: 10px;
          border-radius: 5px;
          margin-top: 10px;
          font-weight: bold;
          width: 90%;
        }

        .status {
          background: white;
          color: red;
          padding: 8px;
          border-radius: 5px;
          font-size: 14px;
          margin-top: 10px;
          text-align: right;
          font-weight: bold;
          width: 50%;
          align-self: flex-end;
          margin-right: 3%;
        }

        .add-btn {
          background: #e33;
          color: white;
          padding: 10px 20px;
          border-radius: 5px;
          border: none;
          font-weight: bold;
          cursor: pointer;
          margin-top: 15px;
          font-size: 14px;
          width: 90%;
        }

        /* 테이블 스타일 */
        table {
          width: 100%;
          border-collapse: collapse;
          font-size: 14px;
          margin-top: 5px;
        }

        th, td {
          border: 1px solid #ccc;
          padding: 5px;
          text-align: center;
        }

        th {
          background-color: #f4f4f4;
          color: #222;
        }

        td {
          background-color: #fff;
          color: #222;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="title">★ 자판기 프로그램 ★</div>

    <button class="end-btn">−</button>

    <div class="header">
        <button class="dropdown">▽ 자판기 상품 목록</button>
        <div class="toggle-wrapper">
            <div class="toggle-container">
                <label>한글</label>
                <div class="toggle" id="toggle"></div>
                <label>ENG</label>
            </div>
        </div>
    </div>

    <div class="content">
        <div class="product-list">상품 목록이 비어있습니다.</div>
        <div class="status">▲ 총 0개의 상품이 있습니다.</div>
        <a th:href="@{/add}" class="add-btn" id="addProductBtn">상품 추가하기!</a>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        fetch("/api/products")
            .then(res => res.json())
            .then(data => {
                const listEl = document.querySelector(".product-list");
                const statusEl = document.querySelector(".status");

                if (data.length === 0) {
                    listEl.textContent = "상품 목록이 비어있습니다.";
                    statusEl.textContent = "▲ 총 0개의 상품이 있습니다.";
                } else {
                    // 테이블 생성
                    const table = document.createElement("table");
                    table.style.width = "100%";
                    table.style.borderCollapse = "collapse";

                    // 헤더 생성
                    const thead = document.createElement("thead");
                    thead.innerHTML = `
                        <tr>
                            <th style="border-bottom:1px solid #999; padding:5px;">이름</th>
                            <th style="border-bottom:1px solid #999; padding:5px;">가격</th>
                            <th style="border-bottom:1px solid #999; padding:5px;">유통기한</th>
                            <th style="border-bottom:1px solid #999; padding:5px;">수정</th>
                            <th style="border-bottom:1px solid #999; padding:5px;">삭제</th>
                        </tr>
                    `;
                    table.appendChild(thead);

                    // 본문 생성
                    const tbody = document.createElement("tbody");
                    data.forEach(product => {
                        const row = document.createElement("tr");

                        row.innerHTML = `
                            <td style="padding:5px;">${product.name}</td>
                            <td style="padding:5px;">${product.price}원</td>
                            <td style="padding:5px;">${product.limit_date}</td>
                            <td style="padding:5px;"><button onclick="editProduct(${product.id})" style="background:blue; color:white; border:none; border-radius:8px; padding:5px 10px; cursor:pointer;">수정</button></td>
                            <td style="padding:5px;"><button onclick="deleteProduct(${product.id})" style="background:red; color:white; border:none; border-radius:8px; padding:5px 10px; cursor:pointer;">삭제</button></td>
                        `;
                        tbody.appendChild(row);
                    });
                    table.appendChild(tbody);

                    // 기존 메시지 제거 후 테이블 삽입
                    listEl.innerHTML = "";
                    listEl.appendChild(table);

                    statusEl.textContent = `▲ 총 ${data.length}개의 상품이 있습니다.`;
                }
            });
    });

    // 수정 버튼 동작 예시
    function editProduct(id) {
        alert("수정 기능 호출됨! 상품 ID: " + id);
        window.location.href = `/edit/${id}`; // 실제 수정 페이지로 이동 시
    }

    // 삭제 버튼 동작 예시
    function deleteProduct(id) {
        if (confirm("정말 삭제하시겠습니까?")) {
            fetch(`/api/products/${id}`, {
                method: "DELETE"
            }).then(() => {
                alert("삭제 완료!");
                location.reload(); // 새로고침으로 목록 갱신
            });
        }
    }

</script>
</body>
</html>
